window.wp=window.wp||{},function(e,t){"use strict";t.envato={},t.envato.ajaxNonce=window._wpUpdatesSettings.ajax_nonce,t.envato.shouldRequestFilesystemCredentials=null,t.envato.filesystemCredentials={ftp:{host:null,username:null,password:null,connectionType:null},ssh:{publicKey:null,privateKey:null}},t.envato.updateLock=!1,t.envato.updateDoneSuccessfully=!1,t.envato.updateQueue=[],t.envato.$elToReturnFocusToFromCredentialsModal=null,t.envato.decrementCount=function(t){var a,n,o=e("#wp-admin-bar-updates .ab-label"),s=e('a[href="update-core.php"] .update-plugins'),i=e("#menu-plugins");if(a=o.text(),!((a=parseInt(a,10)-1)<0||isNaN(a))&&(e("#wp-admin-bar-updates .ab-item").removeAttr("title"),o.text(a),s.each(function(e,t){t.className=t.className.replace(/count-\d+/,"count-"+a)}),s.removeAttr("title"),s.find(".update-count").text(a),"plugin"===t)){if(n=i.find(".plugin-count").eq(0).text(),(n=parseInt(n,10)-1)<0||isNaN(n))return;i.find(".plugin-count").text(n),i.find(".update-plugins").each(function(e,t){t.className=t.className.replace(/count-\d+/,"count-"+n)}),n>0?e(".subsubsub .upgrade .count").text("("+n+")"):e(".subsubsub .upgrade").remove()}},t.envato.updatePlugin=function(a,n){var o,s=e(".envato-card-"+n).find(".update-now"),i=s.data("name"),r=t.i18n.sprintf(t.i18n.__("Updating %s...","envato-market"),i);s.attr("aria-label",r),s.addClass("updating-message"),s.html()!==r&&s.data("originaltext",s.html()),s.text(r),t.envato.updateLock?t.envato.updateQueue.push({type:"update-plugin",data:{plugin:a,slug:n}}):(t.envato.updateLock=!0,o={_ajax_nonce:t.envato.ajaxNonce,plugin:a,slug:n,username:t.envato.filesystemCredentials.ftp.username,password:t.envato.filesystemCredentials.ftp.password,hostname:t.envato.filesystemCredentials.ftp.hostname,connection_type:t.envato.filesystemCredentials.ftp.connectionType,public_key:t.envato.filesystemCredentials.ssh.publicKey,private_key:t.envato.filesystemCredentials.ssh.privateKey},t.ajax.post("update-plugin",o).done(t.envato.updateSuccess).fail(t.envato.updateError))},t.envato.updateTheme=function(a){var n,o=e(".envato-card-"+a).find(".update-now"),s=o.data("name"),i=t.i18n.sprintf(t.i18n.__("Updating %s...","envato-market"),s);o.attr("aria-label",i),o.addClass("updating-message"),o.html()!==i&&o.data("originaltext",o.html()),o.text(i),t.envato.updateLock?t.envato.updateQueue.push({type:"update-theme",data:{theme:a}}):(t.envato.updateLock=!0,n={_ajax_nonce:t.envato.ajaxNonce,theme:a,slug:a,username:t.envato.filesystemCredentials.ftp.username,password:t.envato.filesystemCredentials.ftp.password,hostname:t.envato.filesystemCredentials.ftp.hostname,connection_type:t.envato.filesystemCredentials.ftp.connectionType,public_key:t.envato.filesystemCredentials.ssh.publicKey,private_key:t.envato.filesystemCredentials.ssh.privateKey},t.ajax.post("update-theme",n).done(t.envato.updateSuccess).fail(t.envato.updateError))},t.envato.updateSuccess=function(a){var n,o,s,i,r,u,d;o=(n=e(".envato-card-"+a.slug)).find(".column-update"),s=n.find(".update-now"),i=n.find(".version"),r=s.data("name"),u=s.data("version"),d=i.attr("aria-label").replace("%s",u),s.addClass("disabled");var l=t.i18n.sprintf(t.i18n.__("Updating %s...","envato-market"),r);s.attr("aria-label",l),i.text(d),s.removeClass("updating-message").addClass("updated-message"),s.text(t.i18n.__("Updated!","envato-market")),t.a11y.speak(l),o.addClass("update-complete").delay(1e3).fadeOut(),t.envato.decrementCount("plugin"),t.envato.updateDoneSuccessfully=!0,t.envato.updateLock=!1,e(document).trigger("envato-update-success",a),t.envato.queueChecker()},t.envato.updateError=function(a){var n;t.envato.updateDoneSuccessfully=!1,a.errorCode&&"unable_to_connect_to_filesystem"===a.errorCode&&t.envato.shouldRequestFilesystemCredentials?t.envato.credentialError(a,"update-plugin"):((n=e(".envato-card-"+a.slug).find(".update-now")).data("name"),n.attr("aria-label",t.i18n.__("Updating failed","envato-market")),n.removeClass("updating-message"),n.html(t.i18n.sprintf(t.i18n.__("Updating failed %s...","envato-market"),"string"!==a.errorMessage?a.errorMessage:a.error)),t.envato.updateLock=!1,e(document).trigger("envato-update-error",a),t.envato.queueChecker())},t.envato.showErrorInCredentialsForm=function(t){var a=e(".notification-dialog");a.find(".error").remove(),a.find("h3").after('<div class="error">'+t+"</div>")},t.envato.credentialError=function(e,a){t.envato.updateQueue.push({type:a,data:{plugin:e.plugin,slug:e.slug}}),t.envato.showErrorInCredentialsForm(e.error),t.envato.requestFilesystemCredentials()},t.envato.queueChecker=function(){var e;t.envato.updateLock||t.envato.updateQueue.length<=0||(e=t.envato.updateQueue.shift(),t.envato.updatePlugin(e.data.plugin,e.data.slug))},t.envato.requestFilesystemCredentials=function(a){!1===t.envato.updateDoneSuccessfully&&(t.envato.$elToReturnFocusToFromCredentialsModal=e(a.target),t.envato.updateLock=!0,t.envato.requestForCredentialsModalOpen())},t.envato.keydown=function(a){27===a.keyCode?t.envato.requestForCredentialsModalCancel():9===a.keyCode&&("upgrade"!==a.target.id||a.shiftKey?"hostname"===a.target.id&&a.shiftKey&&(e("#upgrade").focus(),a.preventDefault()):(e("#hostname").focus(),a.preventDefault()))},t.envato.requestForCredentialsModalOpen=function(){var a=e("#request-filesystem-credentials-dialog");e("body").addClass("modal-open"),a.show(),a.find("input:enabled:first").focus(),a.keydown(t.envato.keydown)},t.envato.requestForCredentialsModalClose=function(){e("#request-filesystem-credentials-dialog").hide(),e("body").removeClass("modal-open"),t.envato.$elToReturnFocusToFromCredentialsModal.focus()},t.envato.requestForCredentialsModalCancel=function(){var a,n;!1===t.envato.updateLock&&0===t.envato.updateQueue.length||(a=t.envato.updateQueue[0].data.slug,t.envato.updateLock=!1,t.envato.updateQueue=[],t.envato.requestForCredentialsModalClose(),(n=e(".envato-card-"+a).find(".update-now")).removeClass("updating-message"),n.html(n.data("originaltext")))},t.envato.beforeunload=function(){if(t.envato.updateLock)return t.i18n.__("Update in progress, really leave?","envato-market")},e(document).ready(function(){t.envato.shouldRequestFilesystemCredentials=!(e("#request-filesystem-credentials-dialog").length<=0),e("#request-filesystem-credentials-dialog form").on("submit",function(){return t.envato.filesystemCredentials.ftp.hostname=e("#hostname").val(),t.envato.filesystemCredentials.ftp.username=e("#username").val(),t.envato.filesystemCredentials.ftp.password=e("#password").val(),t.envato.filesystemCredentials.ftp.connectionType=e('input[name="connection_type"]:checked').val(),t.envato.filesystemCredentials.ssh.publicKey=e("#public_key").val(),t.envato.filesystemCredentials.ssh.privateKey=e("#private_key").val(),t.envato.requestForCredentialsModalClose(),t.envato.updateLock=!1,t.envato.queueChecker(),!1}),e('#request-filesystem-credentials-dialog [data-js-action="close"], .notification-dialog-background').on("click",function(){t.envato.requestForCredentialsModalCancel()}),e('#request-filesystem-credentials-dialog input[name="connection_type"]').on("change",function(){e(this).parents("form").find("#private_key, #public_key").parents("label").toggle("ssh"===e(this).val())}).change(),e(".envato-card.plugin").on("click",".update-now",function(a){var n=e(a.target);a.preventDefault(),t.envato.shouldRequestFilesystemCredentials&&!t.envato.updateLock&&t.envato.requestFilesystemCredentials(a),t.envato.updatePlugin(n.data("plugin"),n.data("slug"))}),e(".envato-card.theme").on("click",".update-now",function(a){var n=e(a.target);a.preventDefault(),t.envato.shouldRequestFilesystemCredentials&&!t.envato.updateLock&&t.envato.requestFilesystemCredentials(a),t.envato.updateTheme(n.data("slug"))}),e("#plugin_update_from_iframe").on("click",function(t){var a,n;a=window.parent===window?null:window.parent,e.support.postMessage=!!window.postMessage,!1!==e.support.postMessage&&null!==a&&-1===window.parent.location.pathname.indexOf("update-core.php")&&(t.preventDefault(),n={action:"updatePlugin",slug:e(this).data("slug")},a.postMessage(JSON.stringify(n),window.location.origin))})}),e(window).on("message",function(a){var n,o=a.originalEvent,s=document.location,i=s.protocol+"//"+s.hostname;if(o.origin===i&&o.data){try{n=e.parseJSON(o.data)}catch(e){n=o.data}try{if(void 0===n.action)return}catch(e){}try{switch(n.action){case"decrementUpdateCount":t.envato.decrementCount(n.upgradeType);break;case"updatePlugin":tb_remove(),e(".envato-card-"+n.slug).find("h4 a").focus(),e(".envato-card-"+n.slug).find('[data-slug="'+n.slug+'"]').trigger("click")}}catch(e){}}}),e(window).on("beforeunload",t.envato.beforeunload)}(jQuery,window.wp,window.ajaxurl);