!function(e){"use strict";var t,a={cache:{},init:function(){this.bindEvents()},bindEvents:function(){var t=this;t.addItem(),t.removeItem(),t.tabbedNav(),e(document).on("click",".envato-card a.thickbox",function(){return tb_click.call(this),e("#TB_title").css({"background-color":"#23282d",color:"#cfcfcf"}),!1})},addItem:function(){e(document).on("click",".add-envato-market-item",function(n){var o="envato-market-dialog-form";n.preventDefault(),0===e("#"+o).length&&e("body").append(wp.template(o)),t=e("#"+o).dialog({autoOpen:!0,modal:!0,width:350,buttons:{Save:{text:_envatoMarket.i18n.save,click:function(){var n,o,i,r=e(this);r.on("submit",function(e){e.preventDefault()}),o=r.find('input[name="token"]').val(),i=r.find('input[name="id"]').val(),(n=wp.ajax.post(_envatoMarket.action+"_add_item",{nonce:_envatoMarket.nonce,token:o,id:i})).done(function(n){var o=wp.template("envato-market-item"),i=wp.template("envato-market-card"),r=wp.template("envato-market-auth-check-button");e(".nav-tab-wrapper").find('[data-id="'+n.type+'"]').removeClass("hidden"),n.item.type=n.type,e("#"+n.type+"s").append(i(n.item)).removeClass("hidden"),e("#envato-market-items").append(o({name:n.name,token:n.token,id:n.id,key:n.key,type:n.type,authorized:n.authorized})),0===e(".auth-check-button").length&&e("p.submit").append(r),t.dialog("close"),a.addReadmore()}),n.fail(function(e){var a=wp.template("envato-market-dialog-error"),n={message:e.message?e.message:_envatoMarket.i18n.error};t.find(".notice").remove(),t.find("form").prepend(a(n)),t.find(".notice").fadeIn("fast")})}},Cancel:{text:_envatoMarket.i18n.cancel,click:function(){t.dialog("close")}}},close:function(){t.find(".notice").remove(),t.find("form")[0].reset()}})})},removeItem:function(){e(document).on("click","#envato-market-items .item-delete",function(a){var n=this,o="envato-market-dialog-remove";a.preventDefault(),0===e("#"+o).length&&e("body").append(wp.template(o)),t=e("#"+o).dialog({autoOpen:!0,modal:!0,width:350,buttons:{Save:{text:_envatoMarket.i18n.remove,click:function(){var a,o;e(this).on("submit",function(e){e.preventDefault()}),o=e(n).parents("li").data("id"),(a=wp.ajax.post(_envatoMarket.action+"_remove_item",{nonce:_envatoMarket.nonce,id:o})).done(function(){var a=e('.col[data-id="'+o+'"]'),i=a.find(".envato-card").hasClass("theme")?"theme":"plugin";a.remove(),0===e("#"+i+"s").find(".col").length&&(e(".nav-tab-wrapper").find('[data-id="'+i+'"]').addClass("hidden"),e("#"+i+"s").addClass("hidden")),e(n).parents("li").remove(),e("#envato-market-items li").each(function(t){e(this).find("input").each(function(){e(this).attr("name",e(this).attr("name").replace(/\[\d\]/g,"["+t+"]"))})}),0!==e(".auth-check-button").length&&0===e("#envato-market-items li").length&&e("p.submit .auth-check-button").remove(),t.dialog("close")}),a.fail(function(e){var a=wp.template("envato-market-dialog-error"),n={message:e.message?e.message:_envatoMarket.i18n.error};t.find(".notice").remove(),t.find("form").prepend(a(n)),t.find(".notice").fadeIn("fast")})}},Cancel:{text:_envatoMarket.i18n.cancel,click:function(){t.dialog("close")}}}})})},tabbedNav:function(){var t=e(".about-wrap");e("div.panel",t).hide();var a=this.getParameterByName("tab"),n=window.location.hash.substr(1);e(document,t).on("click",".nav-tab-wrapper a",function(){return e(".nav-tab-wrapper a",t).removeClass("nav-tab-active"),e("div.panel",t).hide(),e(this).addClass("nav-tab-active"),e("div"+e(this).attr("href"),t).show(),!1}),a?e('.nav-tab-wrapper a[href="#'+a+'"]',t).click():n?e('.nav-tab-wrapper a[href="#'+n+'"]',t).click():e("div.panel:not(.hidden)",t).first().show()},getParameterByName:function(e){var t;return e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),null===(t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search))?"":decodeURIComponent(t[1].replace(/\+/g," "))}};e(window).on("load",function(){a.init()})}(jQuery);